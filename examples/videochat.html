<html>

<head>
    <title>middleMAM Video Chat</title>
    <script src="../dist/middlemam.lib.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <video id="yourVideo" autoplay muted></video>
    <video id="otherVideo" autoplay></video>
    <br />
    <button onclick="showOtherVideo()" type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-facetime-video" aria-hidden="true"></span> Call</button>
</body>
<script>
// Video functions
var yourVideo = document.getElementById("yourVideo");
var otherVideo = document.getElementById("otherVideo");

function showMyVideo() {
    navigator.mediaDevices.getUserMedia({ audio: true, video: true })
        .then(stream => yourVideo.srcObject = stream)
        .then(stream => channel.addStream(stream));
}

function showOtherVideo() {
    var root = prompt("Please enter root to listen");
    channel.connect(root, secretKey);
}
///////////////////
// Setup
var secretKey = 'VLVIFBLSBVLRIULSIEIQIGFEYD';
var provider = 'https://nodes.devnet.iota.org';
var config = { 'iceServers': [{ 'urls': 'stun:stun.services.mozilla.com' }, { 'urls': 'stun:stun.l.google.com:19302' }, { 'urls': 'turn:numb.viagenie.ca', 'credential': 'webrtc', 'username': 'websitebeaver@mail.com' }] };

// Start opening local data channel
var channel = new MiddleMAM.VideoChannel(secretKey, provider, config);
showMyVideo();
// Listener
channel.on('streamComing', function(stream) {
    otherVideo.srcObject = stream;
});
</script>

</html>